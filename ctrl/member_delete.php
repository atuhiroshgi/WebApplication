<?php
//**************************************************
// 初期処理
//**************************************************
require_once('../model/dbconnect.php');
require_once('../model/dbfunction.php');

//**************************************************
// 変数定義
//**************************************************
$bRet = false;
$arrErr = array();

//**************************************************
// 変数取得
//**************************************************
$sMemberId = isset($_POST['id']) ? $_POST['id'] : "";
$nStepFlg = isset($_POST['step']) ? $_POST['step'] : "";

//**************************************************
// 初期表示（メンバー情報取得）
//**************************************************
if($nStepFlg == ""){
    // メンバー情報の取得
    $member = selectMember($sMemberId);
    
    // メンバーが存在しない場合のエラーハンドリング
    if(empty($member)) {
        die("該当するメンバーが見つかりません");
    }

    // 表示用データの設定
    $sLastName = $member[0]['last_name'];
    $sFirstName = $member[0]['first_name'];
}

//**************************************************
// 削除処理
//**************************************************
if ($nStepFlg == "1"){
    $bRet = deleteMember($sMemberId);

    // 削除失敗時は初期画面に戻す
    if($bRet === false){
        $nStepFlg = "";
    }
}

//**************************************************
// HTML表示
//**************************************************
if($nStepFlg == ""){
    require_once('../view/member_delete.html');
} else if ($nStepFlg == "1") {
    // 削除成功時は完了画面を表示し、その後トップページへリダイレクト
    require_once('../view/member_deleteOK.html');
    if ($bRet) {
        header('Location: index.php?message=メンバーを削除しました');
        exit;
    }
}
?>
